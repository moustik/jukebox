(function(){function r(n,i){if(!n||!i){var s="Notification: Invalid parameters (level, message)";throw new r(e.error,s),new Error(s)}this.level=n,this.message=i;var o=8;this.id=(new Date).getTime()+"."+Math.round(Math.random()*1e5);var u="notification_wrapper_";switch(n){case e.debug:u+="debug",o=3;break;case e.info:u+="info",o=4;break;case e.warning:u+="warning",o=4;break;case e.error:u+="error",o=20;break;case e.fatal:u+="fatal",o=20;break;default:u+="default"}t.push(this);var a='<div class="notification_wrapper" id="notification'+this.id+'">'+'<div class="'+u+'" id="notification_content'+this.id+'">'+"<p>"+i+" </p>"+"</div>"+"</div>";$("notifications").insert(a),this.startTime=new Date,this.endTime=null,$("notification"+this.id).hide();var f=this;Effect.SlideDown("notification"+this.id,{duration:.6,restoreAfterFinish:!1,afterFinish:function(e){Event.observe(e.element,"click",function(){f.remove()})}}),this._timer=setTimeout(function(){f.remove()},o*1e3),Object.seal(this)}var e={debug:1,info:2,warning:3,error:4,fatal:5};Object.freeze(e);var t=[],n=[];r.prototype.remove=function(){if(!this._timer)return;var e=this;Effect.SlideUp("notification"+this.id,{duration:.4,afterFinish:function(r){r.element.remove(),e.endTime=new Date;for(var i=0;i<t.length;i++)if(t[i]==e){t.splice(i,1),Object.freeze(e),n.push(e);break}}}),clearTimeout(this._timer),this._timer=null},this.Notifications={LEVELS:e,history:n,Display:function(e,t){new r(e,t)}},Object.freeze(this.Notifications)})(),this.Jukebox=function(){function r(e){var t=!1,n=1;typeof e=="boolean"&&(t=e,e=arguments[1]||{},n=2),typeof e!="object"&&typeof e!="function"&&(e={});for(var i=arguments.length;n<i;++n){var s=arguments[n];if(s!=null)for(var o in s){var u=e[o],a=s[o];if(e===a)continue;if(t&&a&&(Object.isArray(a)||typeof a=="object")){var f=u&&(Object.isArray(u)||typeof u=="object")?u:Object.isArray(a)?[]:{};e[o]=r(t,f,a)}else a!==undefined&&s.hasOwnProperty(o)&&(e[o]=a)}}return e}function i(e){var t=null;e=Number(e);if(!isNaN(e)){var n=Math.floor(e/3600),r=Math.floor(e%3600/60),i=Math.floor(e%3600%60);t=(n>0?n+":":"")+(r>0?(n>0&&r<10?"0":"")+r+":":"0:")+(i<10?"0":"")+i}return t}function s(e){e=e.sort(function(e,t){return e*1-t*1});var t=[e[0]];for(var n=1;n<e.length;n++)e[n-1]!==e[n]&&t.push(e[n]);return t}function c(e){var t=JSON.stringify(e,null,"	");return t=t.replace(/\n/g,"<br />"),t=t.replace(/\t/g,"&nbsp;&nbsp;&nbsp;"),t}function d(e,t){if(!(this instanceof arguments.callee))return new d(e,t);this.name=e;switch(e){case"join_channel":this.channel=t.channel;break;case"next":case"previous":case"shuffle_play_queue":case"get_uploaded_files":break;case"add_to_play_queue":case"remove_from_play_queue":this.mid=t.mid,this.play_queue_index=t.play_queue_index;break;case"move_in_play_queue":this.mid=t.mid,this.play_queue_index=t.play_queue_index,this.new_play_queue_index=t.new_play_queue_index;break;case"get_news":this.first_result=t.first_result,this.result_count=t.result_count;break;case"select_plugin":this.channel=t.channel,this.plugin_name=t.plugin_name;break;case"search":case"update_uploaded_file":case"add_search_to_play_queue":r(this,t);break;case"delete_uploaded_file":case"validate_uploaded_file":this.file_name=t.file_name;break;default:throw new Error("Invalid action")}Object.seal(this)}function v(e,t){if(!(this instanceof arguments.callee))return new v(e,t);this.lastTimestamp=e,this.actions=[],this.search=null;if(t)for(var n=0;n<t.length;++n)t[n]instanceof d&&this.actions.push(t[n]);Object.seal(this)}function m(e,t,n){this.name=e,this.uploadedFiles=t,this.uploadedFilesEdition=n}function y(e,t){function N(e){m.addAction(e),C()}function C(){T.activity(!0);if(b!=0){S.push(m),m=new v;return}E!=null&&(clearTimeout(E),E=null),b=!0;var e=m;m=new v,k(e)}function k(e){e.setTimestamp(s),T.sendingQuery(e.valueOf());var t=e.toJSON();new Ajax.Request(i.URL,{method:"POST",postBody:t,onSuccess:_.querySuccess,onFailure:_.queryFailure,onComplete:_.queryComplete})}function L(e){e.timestamp&&(s=e.timestamp),e.current_song&&(a=e.current_song,n.song=r(!0,{},a),n.lastServerResponse=new Date,T.updateCurrentSong(a),T.updateSongTime(a,n.lastServerResponse.getTime()/1e3));if(e.channel_infos){o=e.channel_infos,n.channel=o.name;var t="",i;p>e.channel_infos.listener_count?(i=p-e.channel_infos.listener_count,t=i+" user"+(i>1?"s":"")+" left the channel",Notifications.Display(Notifications.LEVELS.debug,t)):p<e.channel_infos.listener_count&&(i=e.channel_infos.listener_count-p,t=i+" user"+(i>1?"s":"")+" join the channel",Notifications.Display(Notifications.LEVELS.debug,t)),n.listenersCount=p=e.channel_infos.listener_count,T.updateNbUsers(p)}if(e.play_queue){T.cleanupPlayQueue(),u=e.play_queue.songs;var f=r(!0,[],u);T.displayPlayQueue(f,p)}e.search_results&&T.displaySearchResults(e.search_results),e.messages&&e.messages.each(function(e){Notifications.Display(e.level,e.message)}),e.uploaded_files&&(x=e.uploaded_files,T.displayUploadedFiles(x))}function A(e,t){var n;if(Object.isArray(e)&&Object.isArray(t))for(var r=0,i=Math.min(e.length,t.length);r<i;r++)n=new d("add_to_play_queue",{mid:e[r],play_queue_index:t[r]}),m.addAction(n);else n=new d("add_to_play_queue",{mid:e,play_queue_index:t}),m.addAction(n);C()}function O(e,t){var n;if(arguments.length==0)for(var r=u.length-1;r>=0;--r)n=new d("remove_from_play_queue",{mid:r,play_queue_index:r}),m.addAction(n);else if(Object.isArray(e)&&Object.isArray(t))for(var i=0,s=Math.min(e.length,t.length);i<s;++i)n=new d("remove_from_play_queue",{mid:e[i],play_queue_index:t[i]}),m.addAction(n);else n=new d("remove_from_play_queue",{mid:e,play_queue_index:t}),m.addAction(n);C()}function M(e,t,n,r,i,s,o){var u={play_queue_position:e,select_fields:"mid",search_value:t,search_comparison:n,search_field:r,order_by:i,first_result:0,result_count:null};n=="like"&&(u.first_result=s,u.result_count=o),N(new d("add_search_to_play_queue",u))}function D(){Object.seal(n),T=new w(n,e,{replaceTitle:i.replaceTitle}),i.autorefresh&&C()}if(!(this instanceof arguments.callee))return new y(e,t);this.name="Jukebox"+ ++g,this.stream="",this.channel="",this.song=null,this.listenersCount=0,this.streaming=!1,this.playing=!1,this.lastServerResponse=null;var n=this,i=r(!0,{},y.defaults,t),s=0,o=null,u=[],a=null,f=new Sound,l="/stream",c=null,h=100,p=0,m=new v(0),b=!1,E=null,S=[],x={},T=null;this.ready=function(e){function r(){typeof Sound.__thisMovie(f.object_id).proxyMethods=="function"?e.call(n):setTimeout(r,100)}if(typeof e!="function"){var t="Invalid parameter: .ready() needs a function";throw Notifications.Display(Notifications.LEVEL.error,t),new Error(t)}return r(),this},this.autoRefresh=function(e){return i.autorefresh=!!e,i.autorefresh&&C(),this},this.refresh=function(){return s=0,C(),this},this.joinChannel=function(e){return N(new d("join_channel",{channel:e})),this},this.play=function(e){return this.streaming?this.start():(l=e?e:l,this.stream=l,f.loadSound(l,!0),this.volume(h),this.streaming=!0,T.playing(this.playing=!0)),this},this.start=function(){return f.start(),T.playing(this.playing=!0),clearTimeout(c),this},this.stop=function(){f.stop(),T.playing(this.playing=!1);var e=this;return c=setTimeout(function(){e.stopStreaming()},3e4),this},this.stopStreaming=function(){return f.loadSound(null,!1),this.streaming=!1,T.playing(this.playing=!1),this},this.volume=function(e){if(arguments.length>0){e=Number(e);if(e<0||e>100){var t="Invalid volume level: "+e+" is not in 0-100 range";throw Notifications.Display(Notifications.LEVEL.error,t),new Error(t)}f.setVolume(e),T.volume(e)}return h=f.getVolume()},this.search=function(){var e=d.search.apply(0,arguments);return N(e),this},this.addToPlayQueue=function(e,t){return A(e,t),this},this.addToPlayQueueRandom=function(e){return A(e,Math.floor(Math.random()*u.length)),this},this.addToPlayQueueTop=function(e){return A(e,0),this},this.addToPlayQueueBottom=function(e){return A(e,u.length),this},this.playQueueShuffle=function(){return N(new d("shuffle_play_queue")),this},this.playQueueDelete=function(e,t){return arguments.length==0?O():O(e,t),this},this.playQueueMove=function(e,t,n){return N(new d("move_in_play_queue",{mid:e,play_queue_index:t,new_play_queue_index:n})),this},this.playQueueSize=function(){return u.length},this.addSearchToPlayQueueRandom=function(e,t,n,r,i,s){return M("rand",e,t,n,r,i,s),this},this.addSearchToPlayQueueTop=function(e,t,n,r,i,s){return M("head",e,t,n,r,i,s),this},this.addSearchToPlayQueueBottom=function(e,t,n,r,i,s){return M("tail",e,t,n,r,i,s),this},this.next=function(){return N(new d("next")),this},this.previous=function(){return N(new d("previous")),this},this.plugin=function(e){return N(new d("select_plugin",{channel:o.name,plugin_name:e})),this},this.getUploadedFiles=function(){return N(new d("get_uploaded_files")),this},this.uploadedFiles=function(){return x.files?x.files.slice():[]},this.deleteUploadedFile=function(e){return N(new d("delete_uploaded_file",{file_name:e})),this},this.validateUploadedFile=function(e){return N(new d("validate_uploaded_file",{file_name:e})),this},this.updateUploadedFile=function(e){return N(new d("update_uploaded_file",e)),this};var _={querySuccess:function(e){i.autorefresh&&(E=setTimeout(function(){C()},i.autorefresh_delay));if(e.readyState==4&&e.status==0){T.gotResponse(null);return}T.gotResponse(e.responseText);try{var t=e.responseText.evalJSON();L(t)}catch(n){Notifications.Display(Notifications.LEVELS.error,"Error while parsing server response: "+n.message)}S.length>0&&(S=[],C())},queryFailure:function(){T.gotResponse(null)},queryComplete:function(){b=!1,T.activity(!1)}};D()}function w(e,n,s){function S(){E.music_wrapper.style.display="inline",E.expand_button.hide(),E.collapse_button.style.display="block",E.page_wrapper.setStyle({width:"900px"})}function x(){E.music_wrapper.hide(),E.expand_button.show(),E.collapse_button.hide(),E.page_wrapper.setStyle({width:"280px"})}function T(e,t,n,r,i,s,o,u,a){s||(s=E.search_field.value),r||(s!="genre"?r=E.search_input.value:r=E.search_genres.value),u||(u=E.results_per_page.value),d.search(e,t,n,r,i,s,o,u,a)}function N(e,t){Droppables.add(e,{accept:["play_queue_draggable","library_draggable"],overlap:"vertical",hoverclass:"droppable_hover",onDrop:function(e,n){var r,i;if(e.hasClassName("play_queue_draggable")){r=parseInt(e.id.substring(16),10),i=e.retrieve("mid");var s=-1;n.id!="play_queue_li_first"&&(s=parseInt(n.id.substring(14),10)),s<=r&&s++;if(s!=r){d.playQueueMove(i,r,s),u.cleanupPlayQueue();var o=t[r];t.splice(r,1),t.splice(s,0,o),u.displayPlayQueue(t)}}else if(e.hasClassName("library_draggable")){var a=e.id.replace(/.*_([^_]*_[^_]*)_[0-9]*/,"$1");r=parseInt(e.id.replace(/.*_[^_]*_[^_]*_([0-9]*)/,"$1"),10);var f=v.getTabFromUniqueId(a).server_results[r];i=f.mid;var l=-1;n.id!="play_queue_li_first"&&(l=parseInt(n.id.substring(14),10)),l++,d.addToPlayQueue(i,l),t.splice(l,0,f),u.displayPlayQueue(t)}}})}function k(){Object.seal(u),E.expand_button.on("click",C.expand),E.collapse_button.on("click",C.collapse),E.play_stream.on("click",C.playStream),E.stop_stream.on("click",C.stopStream),E.btn_join_channel.on("click",C.joinChannel),E.btn_search.on("click",C.search),E.search_field.on("change",C.selectAndFillGenres),E.search_input.observe("keypress",C.searchInputKeyPress),E.previous_button.on("click",C.previousSong),E.next_button.on("click",C.nextSong),E.cb_autorefresh.on("change",C.autoRefreshChange),E.btn_refresh.on("click",C.refresh),E.btn_apply_plugin.on("click",C.plugin);var e=$R(0,100);g=new Control.Slider(E.volume_box_slider.down(".handle"),E.volume_box_slider,{range:e,values:e,sliderValue:100,onSlide:C.volume,onChange:C.volume}),function(){function n(e){m["Show"+e.classN]=function(){var t=v.getFirstTabIdentifierByClassName(e.classN);if(t==null){var n=new e.classC(e.identifier,e.name,d);t=v.addTab(n)}v.toggleTab(t)}}var e=[{classN:"UploadTab",classC:f,identifier:"Uploader",name:"Uploader"},{classN:"DebugTab",classC:l,identifier:"Debug",name:"Debug"},{classN:"NotificationTab",classC:p,identifier:"Notifications",name:"Notifications"},{classN:"CustomQueriesTab",classC:h,identifier:"Custom queries",name:"Custom queries"}];for(var t=0;t<e.length;++t)n(e[t]);$("tab_upload").on("click",m.ShowUploadTab),$("tab_query").on("click",m.ShowCustomQueriesTab),$("tab_notifs").on("click",m.ShowNotificationTab),$("tab_debug").on("click",m.ShowDebugTab)}()}if(!(this instanceof arguments.callee))return new w(n,s);this.skin=w.skins[0];var u=this,c=r(!0,{},w.defaults,s),d=e,v=new o("tab"),m={},g,y=null,b=null,E={elem:$(n),music_wrapper:$("music_wrapper"),expand_button:$("expand_button"),collapse_button:$("collapse_button"),page_wrapper:$("page_wrapper"),search_input:$("search_input"),search_field:$("search_field"),search_genres:$("search_genres"),results_per_page:$("results_per_page"),btn_search:$("btn_search"),progressbar:$("progressbar"),player_song_time:$("player_song_time"),activity_monitor:$("activity_monitor"),play_stream:$("play_stream"),stop_stream:$("stop_stream"),channel:$("channel"),btn_join_channel:$("btn_join_channel"),previous_button:$("previous_button"),next_button:$("next_button"),cb_autorefresh:$("cb_autorefresh"),btn_refresh:$("btn_refresh"),player_song_artist:$("player_song_artist"),player_song_album:$("player_song_album"),player_song_title:$("player_song_title"),play_queue_content:$("play_queue_content"),selection_plugin:$("music_selection_plugin"),btn_apply_plugin:$("btn_apply_plugin"),volume_box_slider:$("volume_box_slider")};this.activity=function(e){var t=c.ActivityMonitorColor.inactive;e==1&&(t=c.ActivityMonitorColor.active),E.activity_monitor.setStyle({backgroundColor:t})},this.volume=function(e){g.setValue(e)},this.updateSongTime=function(e,t){y&&clearTimeout(y);var n=100;if(e){var r=e.elapsed+(new Date).getTime()/1e3-t;n=(Math.ceil(r)-r)*1e3,r>e.duration&&(r=e.duration);if(b==null||r>b){var s=Math.round(r/e.duration*100);E.progressbar.setStyle({width:s+"%"}),E.player_song_time.update(i(r)+"/"+i(e.duration))}b=r}else b=null,E.progressbar.setStyle({width:0}),E.player_song_time.update("--- / ---");y=setTimeout(function(){u.updateSongTime(e,t)},n+1)},this.updateCurrentSong=function(e){if(e){function t(e,t){T(1,null,null,e,"equal",t,"artist,album,track,title",null,!1)}E.player_song_artist.update(e.artist).stopObserving().on("click",function(){t(e.artist,"artist")}),E.player_song_album.update(e.album).stopObserving().on("click",function(){t(e.album,"album")}),E.player_song_title.update(e.title),c.replaceTitle&&(document.title="Jukebox - "+e.artist+" - "+e.album+" - "+e.title)}},this.updateNbUsers=function(e){var t=$$("span.count_user_listening");t.length>0&&t.each(function(t){t.update(e.toString())})},this.playing=function(e){e?(E.play_stream.hide(),E.stop_stream.style.display="inline"):(E.play_stream.show(),E.stop_stream.hide())},this.cleanupPlayQueue=function(){var e=E.play_queue_content.select("li").length-1;for(var t=0;t<e;++t)Droppables.remove("play_queue_song_"+t)},this.displayPlayQueue=function(e){var t=new Element("ul"),n='<li id="play_queue_li_first" class="droppable">Play queue<div><span class="nb_listening_users"></span><span class="count_user_listening">'+d.listenersCount+"</span>"+"</div>"+'<a><span class="play_queue_shuffle"></span></a>'+'<a><span class="play_queue_delete"></span></a>'+"</li>";t.insert(n),t.down(".play_queue_shuffle").on("click",function(){d.playQueueShuffle()}),t.down(".play_queue_delete").on("click",function(){d.playQueueDelete()});var r=0,s=e.length-1;e.each(function(e){n='<li id="play_queue_li_'+r+'" class="droppable">'+'<div id="play_queue_song_'+r+'" class="play_queue_draggable">'+'<div id="play_queue_handle_'+r+'" class="play_queue_handle">'+'<a href="javascript:void(0)">'+e.artist+"</a>"+" - "+'<a href="javascript:void(0)">'+e.album+"</a>"+" - "+e.title+" ("+i(e.duration)+")"+"</div>"+'<a><span class="play_queue_move_top"></span></a>'+'<a><span class="play_queue_move_bottom"></span></a>'+'<a><span class="play_queue_delete"></span></a>'+"</div>"+"</li>",t.insert(n),t.down("li:last > div").store("mid",e.mid),t.down("li:last .play_queue_handle a:first").on("click",function(){T(1,null,null,e.artist,"equal","artist","artist,album,track,title",20,!1)}),t.down("li:last .play_queue_handle a:last").on("click",function(){T(1,null,null,e.album,"equal","album","artist,album,track,title",20,!1)});var o=r;t.down("li:last .play_queue_move_top").on("click",function(){d.playQueueMove(1,o,0)}),t.down("li:last .play_queue_move_bottom").on("click",function(){d.playQueueMove(1,o,s)}),t.down("li:last .play_queue_delete").on("click",function(){d.playQueueDelete(1,o)}),r++}),E.play_queue_content.update(t);for(var o=0,u=e.length;o<u;o++)new Draggable("play_queue_song_"+o,{scroll:window,constraint:"vertical",revert:!0,handle:"play_queue_handle_"+o,onStart:function(e){var t=e.element.id;t=t.substring(16),$("play_queue_li_"+t).addClassName("being_dragged")},onEnd:function(e){var t=e.element.id;t=t.substring(16),$("play_queue_li_"+t).removeClassName("being_dragged")}}),N("play_queue_li_"+o,e);N("play_queue_li_first",e)},this.displaySearchResults=function(e){S();if(!e.identifier){var t=new a(d,e),n=v.addTab(t);e.select!==!1&&v.toggleTab(n)}else v.getTabFromUniqueId(e.identifier).updateNewSearchInformations(e),v.getTabFromUniqueId(e.identifier).updateContent()},this.sendingQuery=function(e){var t=v.getFirstTabByClassName("DebugTab");t&&t.updateSendingQuery(e)},this.gotResponse=function(e){var t=v.getFirstTabByClassName("DebugTab");t&&t.updateResponse(e)},this.displayUploadedFiles=function(e){var t=v.getFirstTabByClassName("UploadTab");t&&t.treatResponse(e)};var C={expand:function(){S()},collapse:function(){x()},joinChannel:function(){d.joinChannel(E.channel.value)},previousSong:function(){d.previous()},nextSong:function(){d.next()},playStream:function(){d.play()},stopStream:function(){d.stop()},volume:function(e){d.volume()!=e&&d.volume(e)},search:function(){T()},searchInputKeyPress:function(e){e.keyCode==Event.KEY_RETURN&&(T(),Event.stop(e))},selectAndFillGenres:function(){if(E.search_field.options[E.search_field.selectedIndex].value=="genre"){if(E.search_genres.options.length==0)for(var e=0,n=t.length;e<n;++e){var r=t[e],i=document.createElement("option");i.value=r.id,i.appendChild(document.createTextNode(r.name)),E.search_genres.appendChild(i)}E.search_input.hide(),E.search_genres.show()}else E.search_input.show(),E.search_genres.hide()},autoRefreshChange:function(){d.autoRefresh(E.cb_autorefresh.getValue())},refresh:function(){d.refresh()},plugin:function(){d.plugin(E.selection_plugin.value)}};k()}var e={0:"Blues",1:"Classic Rock",2:"Country",3:"Dance",4:"Disco",5:"Funk",6:"Grunge",7:"Hip-Hop",8:"Jazz",9:"Metal",10:"New Age",11:"Oldies",12:"Other",13:"Pop",14:"R&B",15:"Rap",16:"Reggae",17:"Rock",18:"Techno",19:"Industrial",20:"Alternative",21:"Ska",22:"Death Metal",23:"Pranks",24:"Soundtrack",25:"Euro-Techno",26:"Ambient",27:"Trip-Hop",28:"Vocal",29:"Jazz+Funk",30:"Fusion",31:"Trance",32:"Classical",33:"Instrumental",34:"Acid",35:"House",36:"Game",37:"Sound Clip",38:"Gospel",39:"Noise",40:"Alternative Rock",41:"Bass",43:"Punk",44:"Space",45:"Meditative",46:"Instrumental Pop",47:"Instrumental Rock",48:"Ethnic",49:"Gothic",50:"Darkwave",51:"Techno-Industrial",52:"Electronic",53:"Pop-Folk",54:"Eurodance",55:"Dream",56:"Southern Rock",57:"Comedy",58:"Cult",59:"Gangsta",60:"Top 40",61:"Christian Rap",62:"Pop/Funk",63:"Jungle",64:"Native US",65:"Cabaret",66:"New Wave",67:"Psychadelic",68:"Rave",69:"Showtunes",70:"Trailer",71:"Lo-Fi",72:"Tribal",73:"Acid Punk",74:"Acid Jazz",75:"Polka",76:"Retro",77:"Musical",78:"Rock & Roll",79:"Hard Rock",80:"Folk",81:"Folk-Rock",82:"National Folk",83:"Swing",84:"Fast Fusion",85:"Bebob",86:"Latin",87:"Revival",88:"Celtic",89:"Bluegrass",90:"Avantgarde",91:"Gothic Rock",92:"Progressive Rock",93:"Psychedelic Rock",94:"Symphonic Rock",95:"Slow Rock",96:"Big Band",97:"Chorus",98:"Easy Listening",99:"Humour",100:"Acoustic",101:"Speech",102:"Chanson",103:"Opera",104:"Chamber Music",105:"Sonata",106:"Symphony",107:"Booty Bass",108:"Primus",109:"Porn Groove",110:"Satire",111:"Slow Jam",112:"Club",113:"Tango",114:"Samba",115:"Folklore",116:"Ballad",117:"Power Ballad",118:"Rhytmic Soul",119:"Freestyle",120:"Duet",121:"Punk Rock",122:"Drum Solo",123:"Acapella",124:"Euro-House",125:"Dance Hall",126:"Goa",127:"Drum & Bass",128:"Club-House",129:"Hardcore",130:"Terror",131:"Indie",132:"BritPop",133:"Negerpunk",134:"Polsk Punk",135:"Beat",136:"Christian Gangsta",137:"Heavy Metal",138:"Black Metal",139:"Crossover",140:"Contemporary C",141:"Christian Rock",142:"Merengue",143:"Salsa",144:"Thrash Metal",145:"Anime",146:"JPop",147:"SynthPop"},t=[];for(var n in e)t.push({id:n,name:e[n]});t.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0});var o=Class.create({initialize:function(e){this.tabsCollectionName=e,this.tabs=[],this.currentTabUniqueId=-1,this.lastUniqueId=null},getTabFromUniqueId:function(e){for(var t=0;t<this.tabs.length;++t)if(this.tabs[t].identifier==e)return this.tabs[t];return null},getTabIndexFromUniqueId:function(e){for(var t=0;t<this.tabs.length;++t)if(this.tabs[t].identifier==e)return t;return-1},getFirstTabIdentifierByClassName:function(e){for(var t=0;t<this.tabs.length;++t)if(undefined!=this.tabs[t].unique&&this.tabs[t].unique==e)return this.tabs[t].identifier;return null},getFirstTabByClassName:function(e){for(var t=0;t<this.tabs.length;++t)if(undefined!=this.tabs[t].unique&&this.tabs[t].unique==e)return this.tabs[t];return null},addTab:function(e){var t=e.constructor;while(t.superclass!=null)t=t.superclass;if(t!=u)throw new Error("Invalid tab instance");this.lastUniqueId==null?this.lastUniqueId=0:this.lastUniqueId++;var n=e.identifier=this.tabsCollectionName+"_"+this.lastUniqueId;this.tabs.push(e),this.tabs.length==1&&$("tabsHeader").update('<ul id="tabs_list"></ul>');var r=(new Element("a",{href:"javascript:;"})).update("<span>"+e.name+"</span>"),i=(new Element("a",{href:"javascript:;"})).update("<span> X </span>"),s=this;r.on("click",function(){s.toggleTab(n)}),i.on("click",function(){s.removeTab(n)});var o=(new Element("li",{style:"margin-left: 1px",id:"tabHeader_"+n})).insert({top:r,bottom:i});this.tabs.length==1&&o.addClassName("tabHeaderActive");var a=new Element("div",{id:"tabContent_"+n});return a.style.display=this.tabs.length==1?"block":"none",$("tabs_list").insert({bottom:o}),$("tabscontent").insert({bottom:a}),typeof e.updateContent=="function"&&e.updateContent(),n},removeTab:function(e){var t=this.getTabIndexFromUniqueId(e);if(t!=-1){var n=$("tabHeader_"+e),r=$("tabContent_"+e);n&&n.hasClassName("tabHeaderActive")&&(t!=0?this.toggleTab(this.tabs[t-1].identifier):this.tabs.length>1&&this.toggleTab(this.tabs[t+1].identifier)),this.tabs.splice(t,1),n&&n.remove(),r&&r.remove()}},toggleTab:function(e){for(var t=0;t<this.tabs.length;t++){var n=this.tabs[t].identifier,r=$("tabHeader_"+n),i=$("tabContent_"+n);n==e?(i.style.display="block",r.addClassName("tabHeaderActive")):(i.style.display="none",r.removeClassName("tabHeaderActive"))}}}),u=Class.create({initialize:function(e,t){this.identifier=e,this.name=t},getName:function(){return this.name},getIdentifier:function(){return this.identifier}}),a=Class.create(u,{initialize:function(e,t){this.reloadControllers=!0,this.pages=[],this.sliders=[],this.tableKit=null,this.jukebox=e,this.identifier=t.identifier,this.updateNewSearchInformations(t)},updateNewSearchInformations:function(t){var n=t.search_value,r=t.search_field;n==""?this.name="Library":t.search_comparison=="equal"?r=="artist"?this.name="Artist: "+n:r=="album"?this.name="Album: "+n:r=="genre"&&(this.name="Genre: "+e[n]):this.name=n,this.select_fields=t.select_fields,this.search_value=t.search_value,this.search_comparison=t.search_comparison,this.search_field=t.search_field,this.first_result=t.first_result,this.result_count=t.result_count,this.order_by=t.order_by,this.total_results=t.total_results,this.server_results=t.results,this.page_count=Math.floor(this.total_results/this.result_count),this.total_results%this.result_count>0&&(this.page_count=this.page_count+1),this.current_page=Math.floor(this.first_result/this.result_count)+1,this.current_page>this.page_count&&(this.current_page=1),this.locked=[]},goToPage:function(e){this.jukebox.search((e-1)*this.result_count,this.identifier,this.select_fields,this.search_value,this.search_comparison,this.search_field,this.order_by,this.result_count)},sort:function(e){this.jukebox.search(this.page,this.identifier,this.select_fields,this.search_value,this.search_comparison,this.search_field,e,this.result_count)},updateContent:function(){if(this.reloadControllers){$$("collection_pagelist_"+this.identifier).each(function(e){e.remove()});var e=$("collection_content_"+this.identifier);e&&e.remove();var t='<div class="collection_pagelist" name="collection_pagelist_'+this.identifier+'"></div>'+'<div id="collection_content_'+this.identifier+'"></div>'+'<div class="collection_pagelist" name="collection_pagelist_'+this.identifier+'"></div>';$("tabContent_"+this.identifier).update(t),this.initAndDisplaySearchControllers(),this.reloadControllers=!1}else{this.generatePagesLinks();for(var n in this.sliders)typeof this.sliders[n].setValue=="function"&&(this.locked[n]=!0,this.sliders[n].setValue(this.current_page),this.locked[n]=!1)}this.initAndDisplaySearchResults()},initAndDisplaySearchControllers:function(){var e=this.identifier,t=$$("[name=collection_pagelist_"+e+"]");t.each(function(e){e.update()});if(this.total_results>0&&this.page_count>1){var n=$("music_wrapper").getWidth(),r='<div name="results_slider_'+e+'" class="slider" style="width:'+n+'px;">'+'<div class="handle"></div>'+"</div>",i='<div class="page_links" name="page_links_'+e+'"></div>';t[0].update("<p>"+r+i+"</p>"),t[1].update("<p>"+i+r+"</p>")}for(var s=0;s<this.page_count;++s)this.pages.push(s+1);this.generatePagesLinks();var o=$$("[name=results_slider_"+e+"]"),u=this,a=0;o.each(function(e){var t=new Control.Slider(e.down(".handle"),e,{range:$R(1,u.pages.length),values:u.pages,sliderValue:u.current_page||1,id:a++,timeout:null,lastSelectedValue:null,onSlide:function(e){u.generatePagesLinks(e);for(var t=0;t<u.sliders;++t)t!=this.id&&(u.locked[t]=!0,typeof u.sliders[t].setValue=="function"&&u.sliders[t].setValue(e),u.locked[t]=!1);this.lastSelectedValue!=e&&(clearTimeout(this.timeout),this.timeout=setTimeout(function(){u.goToPage(e)},400)),this.lastSelectedValue=e},onChange:function(e){u.locked[this.id]||(clearTimeout(this.timeout),u.current_page!=e&&u.goToPage(e))}});u.sliders.push(t)})},declareTableHeader:function(){function o(t,i,o){var u=(new Element(r,{id:"duration"})).update(o),a="DESC";e.indexOf(t)!=-1&&(e.indexOf(a)==-1?u.className="sortcol sortasc":(u.className="sortcol sortdesc",a="ASC")),i=i.replace("${ORDER}",a),u.on("click",function(){s.sort(i)}),n.insert(u)}function u(){t.addSearchToPlayQueueRandom(s.search_value,s.search_comparison,s.search_field,s.order_by,s.first_result,s.result_count)}function a(){t.addSearchToPlayQueueTop(s.search_value,s.search_comparison,s.search_field,s.order_by,s.first_result,s.result_count)}function f(){t.addSearchToPlayQueueBottom(s.search_value,s.search_comparison,s.search_field,s.order_by,s.first_result,s.result_count)}var e=this.order_by.split(",")[0],t=this.jukebox,n=new Element("tr"),r="th",i;i="artist COLLATE NOCASE ${ORDER}, album COLLATE NOCASE DESC, track DESC, title COLLATE NOCASE DESC",o("artist",i,"Artist"),i="album COLLATE NOCASE ${ORDER}, track DESC, title COLLATE NOCASE DESC",o("album",i,"Album"),i="title COLLATE NOCASE ${ORDER}, artist COLLATE NOCASE DESC, album COLLATE NOCASE DESC, track DESC",o("title",i,"Title"),i="track ${ORDER}, artist COLLATE NOCASE DESC, album COLLATE NOCASE DESC, title COLLATE NOCASE DESC",o("track",i,"Track"),i="genre ${ORDER}, artist COLLATE NOCASE DESC, album COLLATE NOCASE DESC, track DESC, title COLLATE NOCASE DESC",o("genre",i,"Genre"),i="duration ${ORDER}, artist COLLATE NOCASE DESC, album COLLATE NOCASE DESC, track DESC, title COLLATE NOCASE DESC",o("duration",i,"Duration");var s=this,l=this.createControlsCell(r,u,a,f);return l.writeAttribute("id","actions"),n.insert(l),n},createControlsCell:function(e,t,n,r){var i=new Element(e),s=(new Element("a")).update('<span class="add_to_play_queue_rand"></span>'),o=(new Element("a")).update('<span class="add_to_play_queue_top"></span>'),u=(new Element("a")).update('<span class="add_to_play_queue_bottom"></span>');return i.insert(o).insert({top:s,bottom:u}),s.on("click",t),o.on("click",n),u.on("click",r),i},initAndDisplaySearchResults:function(){function f(e,t){a.search(1,null,null,e.toString(),"equal",t,"artist,album,track,title",n,!0)}function l(e,t,n){var r=(new Element("a",{href:"javascript:void(0)"})).update(e);return r.on("click",function(){f(t,n)}),r}var t=new Element("tbody"),n=this.result_count,r=$("collection_content_"+this.identifier),s,o=!0,u,a=this.jukebox;if(this.total_results>0){var c=this,h=this.identifier,p=0;this.server_results.each(function(n){function m(){a.addToPlayQueueRandom(n.mid)}function g(){a.addToPlayQueueTop(n.mid)}function y(){a.addToPlayQueueBottom(n.mid)}u=o?"rowodd":"roweven",o=!o;var r=l(n.artist,n.artist,"artist"),f=l(n.album,n.album,"album"),d=[(new Element("td")).insert(r),(new Element("td")).insert(f),(new Element("td")).update(n.title),(new Element("td")).update(n.track),new Element("td"),(new Element("td")).update(i(n.duration))];if(e[n.genre]){var v=l(e[n.genre],n.genre,"genre");d[4].insert(v)}var b=c.createControlsCell("td",m,g,y);d.push(b);var w=(new Element("tr",{id:"library_song_"+h+"_"+p++})).addClassName("library_draggable "+u);for(s=0;s<d.length;++s)w.insert(d[s]);t.insert(w)});var d=(new Date).getTime(),v="results_filelist_"+this.identifier+"_"+d,m=(new Element("table",{id:v})).addClassName("resizable").addClassName("search_table");m.insert(t).insert({top:(new Element("thead")).insert(this.declareTableHeader()),bottom:(new Element("tfoot")).insert(this.declareTableHeader())}),r.update(m),this.tableKit=new TableKit(v,{sortable:!1,editable:!1,trueResize:!0,keepWidth:!0})}else r.update("No results found");if(this.server_results!=null)for(s=0;s<this.server_results.length;s++)new Draggable("library_song_"+this.identifier+"_"+s,{scroll:window,ghosting:!0,revert:function(e){e.style.position="relative"}})},generatePagesLinks:function(e){function p(e,t){var n=(new Element("a",{href:"javascript:void(0)"})).addClassName(t).update(e+" ");return n.on("click",function(){h.goToPage(e)}),n}var t,n,r=[],i=5,o=this.current_page,u=this.page_count;typeof e=="undefined"&&(e=this.current_page);if(u>25)for(t=1,n=Math.ceil(i)+2;t<n;++t)t>0&&t<=u&&r.push(t);else for(t=1;t<=u;++t)r.push(t);var a=[];a[0]=o,r.push(e);for(var f=0;f<a.length;++f){var l=Math.ceil(i/2),c=l;for(t=a[f]-l;t<a[f];++t)t>0&&t<=u&&(l--,r.push(t));r.push(a[f]);for(t=a[f]+1,n=a[f]+Math.ceil(i/2)+1;t<n;++t)t>0&&t<=u&&(c--,r.push(t));if(l>0)for(t=a[f]+Math.ceil(i/2),n=a[f]+Math.ceil(i);t<n;++t)t>0&&t<=u&&r.push(t);else if(c>0)for(t=a[f]-Math.ceil(i),n=a[f]+Math.ceil(i/2);t<n;++t)t>0&&t<=u&&r.push(t)}for(t=u-Math.ceil(i);t<=u;++t)t>0&&t<=u&&r.push(t);r=s(r);var h=this;$$("[name=page_links_"+this.identifier+"]").each(function(n){n.update();var i=null;for(t=0;t<r.length;++t){i!=null&&i!=r[t]-1&&n.insert(" ..... ");var s;r[t]==o?s="slider_link_current_page":r[t]==e?s="slider_link_current_selection":s="slider_link";var u=p(r[t],s);n.insert(u),i=r[t]}})}}),f=Class.create(u,{initialize:function(e,t,n){this.identifier=e,this.name=t,this.uploader=null,this.unique="UploadTab",this.uploadedFiles=null,this.uploadedFilesEdition=null,this.lastSendingDeletionIdentifier=null,this.lastSendingUpdateIdentifier=null,this.lastSendingValidationIdentifier=null,this.refresher=null,this.tableId=(new Date).getTime(),this.jukebox=n},deleteUploadedSong:function(e){if(this.lastSendingDeletionIdentifier==null){var t=unescape(e);this.lastSendingDeletionIdentifier=t,this.jukebox.deleteUploadedFile(t)}},getUploadedFileEditionFromFilename:function(e){if(this.uploadedFilesEdition==null)return null;for(var t=0,n=this.uploadedFilesEdition.length;t<n;++t)if(this.uploadedFilesEdition[t].filename==e)return this.uploadedFilesEdition[t];return null},updateUploadedSong:function(e){if(this.lastSendingUpdateIdentifier==null){var t=unescape(e);this.lastSendingUpdateIdentifier=t;var n=this.getUploadedFileEditionFromFilename(t),r={file_name:t,title:n.title,album:n.album,artist:n.artist,year:n.year,track:n.track,genre:n.genre};this.jukebox.updateUploadedFile(r)}},validateUploadedSong:function(e){if(this.lastSendingValidationIdentifier==null){var t=unescape(e);this.lastSendingValidationIdentifier=t,this.jukebox.validateUploadedFile(t)}},deletionResponse:function(e,t){if(e=="success"){if(this.lastSendingDeletionIdentifier!=null){for(var n=0,r=this.uploadedFiles.length;n<r;++n)if(this.uploadedFiles[n].filename==this.lastSendingDeletionIdentifier){this.uploadedFiles.splice(n,1),this.uploadedFilesEdition.splice(n,1);break}$("upload_line_"+escape(this.lastSendingDeletionIdentifier)).remove(),Notifications.Display(2,"Song "+this.lastSendingDeletionIdentifier+" sucessfully deleted"),this.lastSendingDeletionIdentifier=null,this.reinitTable()}}else e=="error"&&(this.lastSendingDeletionIdentifier=null,Notifications.Display(4,t))},updateResponse:function(e,t){if(e=="success"){Notifications.Display(1,t);var n=escape(this.lastSendingUpdateIdentifier),r="upload_line_"+n,i=$(r);i.select('[class="modified"]').each(function(e){e.removeClassName("modified")}),i.select('[class="update"]').each(function(e){e.hide()}),i.select('[class="validate"]').each(function(e){e.show()})}else e=="error"&&Notifications.Display(4,t);this.lastSendingUpdateIdentifier=null},validationResponse:function(e,t){if(e=="success"){Notifications.Display(1,t);if(this.lastSendingValidationIdentifier!=null){for(var n=0,r=this.uploadedFiles.length;n<r;++n)if(this.uploadedFiles[n].filename==this.lastSendingValidationIdentifier){this.uploadedFiles.splice(n,1),this.uploadedFilesEdition.splice(n,1);break}$("upload_line_"+escape(this.lastSendingValidationIdentifier)).remove(),this.lastSendingValidationIdentifier=null,this.reinitTable()}}else e=="error"&&(this.lastSendingValidationIdentifier=null,Notifications.Display(4,t))},reinitTable:function(){var e=$("uploaded_files");if(e.down("tbody").childElementCount==0)e.update("No file uploaded yet."),this.uploadedFilesEdition=null,this.uploadedFiles=null;else{var t=(new Date).getTime();$("uploaded_filelist_"+this.tableId).id="uploaded_filelist_"+t,this.tableId=t,this.tableKit=new TableKit("uploaded_filelist_"+this.tableId,{sortable:!0,editable:!0,trueResize:!0,keepWidth:!0})}},treatResponse:function(e){if(e.action_response){var t=e.action_response,n=t["return"],r=t.message;switch(t.name){case"validate_uploaded_file":this.validationResponse(n,r);break;case"delete_uploaded_file":this.deletionResponse(n,r);break;case"update_uploaded_file":this.updateResponse(n,r)}}e.files&&this.displayUploadedFiles(e.files)},getUploadedFileHtml:function(t){var n='<td class="static">'+t.filename+"</td><td>";t.artist&&(n+=t.artist),n+="</td><td>",t.album&&(n+=t.album),n+="</td><td>",t.title&&(n+=t.title),n+="</td><td>"+t.year+"</td><td>";var r=t.track.toString().indexOf("/");r!=-1?n+=t.track.split("/")[0]:n+=t.track,n+="</td><td>",r!=-1?n+=t.track.split("/")[1]:n+=0,n+="</td><td>",e[t.genre]&&(n+=e[t.genre]),n+='</td><td class="static actions"><div><a href="javascript:void(0);">X</a></div><div class="update" style="display:none;"><a href="javascript:void(0);">&nbsp;Update&nbsp;</a></div><div class="validate"><a href="javascript:void(0);">&nbsp;Validate&nbsp;</a></div></td>';var i=escape(t.filename),s=(new Element("tr",{id:"upload_line_"+i})).update(n),o=s.select("div"),u=this;return o[0].on("click",function(){u.deleteUploadedSong(i)}),o[1].on("click",function(){u.updateUploadedSong(i)}),o[2].on("click",function(){u.validateUploadedSong(i)}),s},displayUploadedFiles:function(e){var t,n,r,i,s=$("uploaded_files"),o=s.down("tbody"),u=this;clearTimeout(this.refresher),this.refresher=setTimeout(function(){u.getUploadedFiles()},5e3);if(this.uploadedFiles==null||o==null||o.childElementCount==0&&e.length>0)if(e.length>0){this.uploadedFiles=JSON.parse(JSON.stringify(e)),this.uploadedFilesEdition=JSON.parse(JSON.stringify(e));var a='<table id="uploaded_filelist_'+this.tableId+'" class="sortable resizable editable upload_table">',f='<tr><th>Filename</th><th class="artist">Artist</th><th class="album">Album</th><th class="title">Title</th><th class="year">Year</th><th class="track">Track</th><th class="trackNb">TrackNb</th><th class="genre">Genre</th><th>Actions</th></tr>';a+="<thead>"+f+"</thead><tfoot>"+f+"</tfoot></table>",s.update(a);var l=new Element("tbody");for(t=0;t<e.length;++t)l.insert(this.getUploadedFileHtml(e[t])),this.removeFileFromQQUpload(e[t].filename);s.down("table").insert(l);function c(e){var t=new m(e,u.uploadedFiles,u.uploadedFilesEdition);TableKit.Editable.addCellEditor(t)}c("artist"),c("album"),c("title"),c("year"),c("track"),c("trackNb"),c("genre"),this.tableKit=new TableKit("uploaded_filelist_"+this.tableId,{sortable:!0,editable:!0,trueResize:!0,keepWidth:!0})}else s.update("No file uploaded yet.");else if(this.uploadedFiles.length>e.length){var h=[];for(n=0,r=this.uploadedFiles.length;n<r;++n){i=!1;for(t=0;t<e.length;++t)if(e[t].filename==this.uploadedFiles[n].filename){i=!0;break}i||h.push(this.uploadedFiles[n].filename)}for(t=0;t<h.length;++t){for(n=0,r=this.uploadedFiles.length;n<r;++n)if(this.uploadedFiles[t].filename==h[t].filename){this.uploadedFiles.splice(t,1),this.uploadedFilesEdition.splice(t,1);break}$("upload_line_"+escape(h[t])).remove()}}else if(this.uploadedFiles.length<e.length){var p=[];for(t=0,r=e.length;t<r;++t){i=!1;for(n=0;n<this.uploadedFiles.length;++n)if(e[t].filename==this.uploadedFiles[n].filename){i=!0;break}i||p.push(e[t])}for(t=0,r=p.length;t<r;++t)this.uploadedFiles.push(JSON.parse(JSON.stringify(p[t]))),this.uploadedFilesEdition.push(JSON.parse(JSON.stringify(p[t]))),$("uploaded_filelist_"+this.tableId).down("tbody").insert(this.getUploadedFileHtml(p[t])),this.removeFileFromQQUpload(p[t].filename);this.uploadedFiles.length!=0&&p.length>0&&this.reinitTable()}},removeFileFromQQUpload:function(e){$$(".qq-upload-success").each(function(t){t.down(".qq-upload-file").innerHTML==e&&(t.remove(),Notifications.Display(1,"Informations for "+e+"successfully retrieved."))})},getUploadedFiles:function(){this.jukebox.getUploadedFiles()},clear:function(){clearTimeout(this.refresher),this.refresher=null,this.uploader._handler._queue.length>0&&Notifications.Display(1,"All current uploads canceled."),this.uploader._handler.cancelAll()},updateContent:function(){var e='<div id="file-uploader'+this.identifier+'"></div>'+"<h2>Uploaded files</h2>"+'<div id="uploaded_files" style="overflow:auto;"></div>';$("tabContent_"+this.identifier).update(e),this.uploader=new qq.FileUploader({element:document.getElementById("file-uploader"+this.identifier),action:"upload",params:{id:this.identifier},debug:!0}),this.getUploadedFiles()}}),l=Class.create(u,{initialize:function(e,t){this.identifier=e,this.name=t,this.unique="DebugTab"},updateSendingQuery:function(e){this.$debug1.update("<h2>Data sent</h2><p>"+c(e)+"</p>"),this.$debug2.update("<h2>Waiting for response...</h2>")},updateResponse:function(e){e?this.$debug2.update("<h2>Data received:</h2><p> "+e+"</p>"+"<h2>JSON response: </h2>"+"<p>"+c(e.evalJSON())+"</p>"):this.$debug2.update('<img src="images/server_down.jpg" />')},updateContent:function(){var e='<h1>Debug console</h1><table width="100%"><tr><td width="50%"><div></div></td><td width="50%"><div></div></td></tr></table>',t=$("tabContent_"+this.identifier);t.update(e),this.$debug1=t.down("div:first"),this.$debug2=t.down("div:last")}}),h=Class.create(u,{initialize:function(e,t){this.identifier=e,this.name=t,this.unique="CustomQueriesTab"},updateContent:function(){var e='<h1>Custom Json Query</h1><table width="100%"><tr><td colspan="2"><center><textarea style="width:100%;height:160px;"></textarea></center></td></tr><tr><td>Query filler : <select><option value="clear_form">clear_form</option><option value="dummy" selected="selected">--------</option><option value="empty">empty</option><option value="next">next</option><option value="previous">previous</option><option value="add_to_play_queue">add_to_play_queue</option><option value="remove_from_play_queue">remove_from_play_queue</option><option value="move_in_play_queue">move_in_play_queue</option><option value="join_channel">join_channel</option><option value="get_news">get_news</option><option value="search">search</option></select></td><td><input type="button" value="send custom query"/></td></tr></table>',t=$("tabContent_"+this.identifier);t.update(e);var n=t.down("textarea"),r=t.down("select");r.on("change",function(){var t={},r=this.value;switch(r){case"dummy":return!1;case"clear_form":return n.value="",this.selectedIndex=1,!1;case"add_to_play_queue":case"remove_from_play_queue":case"move_in_play_queue":t={mid:123,play_queue_index:1};break;case"join_channel":t={channel:"trashman"};break;case"get_news":t={first_result:0,result_count:5};break;case"search":t={search_value:"muse",search_field:"artist",order_by:"artist",first_result:0,result_count:10}}r=="move_in_play_queue"&&(t.new_play_queue_index=0);var i=r=="empty"?[]:[new d(r,t)],s=new v(1317675258,i);return n.value=JSON.stringify(s.valueOf(),null,"	"),this.selectedIndex=1,!1});var i=t.down("input");i.on("click",function(){if(n.value==""){Notifications.Display(Notifications.LEVELS.warning,"Please fill the textarea");return}var t=JSON.parse(n.value);t})}}),p=Class.create(u,{initialize:function(e,t){this.identifier=e,this.name=t,this.uploader=null,this.unique="NotificationTab"},updateContent:function(){function n(t){var n=new Element("input",{type:"button",value:"Test "+t});n.on("click",function(){Notifications.Display(Notifications.LEVELS[t],"Notification: "+t)}),e.insert(n)}var e=$("tabContent_"+this.identifier);e.update("<h1>Notification tests:</h1>");for(var t in Notifications.LEVELS)n(t)}});d.search=function(e,t,n,i,s,o,u,a,f){var l={identifier:t?t:null,select:!!f,search_value:i,search_comparison:s?s:o!="genre"?"like":"equal",search_field:o,first_result:!e||e==1?0:e,result_count:a};u&&(l.order_by=u),n&&(l.select_fields=n);var c=r({},d.search.defaultOptions,l);return new d("search",c)},d.search.defaultOptions={search_value:"",search_comparison:"like",search_field:"",order_by:"artist,album,track,title",select_fields:"mid,title,album,artist,track,genre,duration",first_result:0,result_count:20},v.prototype.addAction=function(e){if(!(e instanceof d))throw new Error("Invalid action parameter");e.name=="search"?this.search=e:this.actions.push(e)},v.prototype.setTimestamp=function(e){this.lastTimestamp=e},v.prototype.removeAllActions=function(){this.actions=[]},v.prototype.toJSON=function(){return Object.toJSON(this.valueOf())},v.prototype.valueOf=function(){var e;return this.actions.length===0?e={timestamp:this.lastTimestamp}:e={timestamp:this.lastTimestamp,action:this.actions.length==1?this.actions[0]:this.actions},this.search&&(e.search=this.search),e},m.prototype._cancel=function(e){var t=Event.findElement(e,"td");Event.stop(e),this.cancel(t)},m.prototype.cancel=function(e){var t=TableKit.getCellData(e);e.innerHTML=t.htmlContent,t.htmlContent="",t.active=!1},m.prototype._undo=function(e){var t=Event.findElement(e,"td");Event.stop(e),this.undo(t)},m.prototype.undo=function(e){var t=e.up("tr"),n=t.id;for(var r=0,i=this.uploadedFiles.length;r<i;++r){var s=escape(this.uploadedFiles[r].filename);if("upload_line_"+s==n){var o="upload_line_"+s,u=$(o);u.select('[class="modified"]').length==1&&(u.select('[class="update"]').each(function(e){e.hide()}),u.select('[class="validate"]').each(function(e){e.show()})),this.name=="track"?e.update(this.uploadedFiles[r].track.split("/")[0]):this.name=="trackNb"?e.update(this.uploadedFiles[r].track.split("/")[1]):e.update(this.uploadedFiles[r][this.name]),this.uploadedFilesEdition[r][this.name]=this.uploadedFiles[r][this.name];break}}e.removeClassName("modified");var a=TableKit.getCellData(e);a.active=!1},m.prototype._submit=function(e){var t=Event.findElement(e,"td"),n=Event.findElement(e,"form");Event.stop(e),this.submit(t,n)},m.prototype.submit=function(t,n){n=n?n:t.down("form");var r=t.up("tr"),i=r.id,s=n.firstChild,o=s.value;this.name=="genre"&&e[o]?t.update(e[o]):t.update(o);for(var u=0,a=this.uploadedFilesEdition.length;u<a;++u){var f=this.uploadedFilesEdition[u],l=escape(f.filename);if("upload_line_"+l==i){this.name=="genre"?f[this.name]=s.options[s.selectedIndex].value:this.name=="track"?f[this.name].toString().indexOf("/")==-1?f[this.name]=o+"/0":f[this.name]=o+"/"+f[this.name].split("/")[1]:this.name=="trackNb"?f["track"].toString().indexOf("/")==-1?f.track=f.track+"/"+o:f.track=f.track.toString().split("/")[0]+"/"+o:f[this.name]=o;if((this.name=="track"&&this.uploadedFiles[u][this.name].split("/")[0]!=o||this.name=="trackNb"&&this.uploadedFiles[u]["track"].split("/")[1]!=o||this.name!="track"&&this.name!="trackNb"&&o!=this.uploadedFiles[u][this.name])&&!t.hasClassName("modified")){t.addClassName("modified");var c=$("upload_line_"+l);c.select('[class="update"]').each(function(e){e.show()}),c.select('[class="validate"]').each(function(e){e.hide()})}else o==this.uploadedFiles[u][this.name]&&t.hasClassName("modified")&&t.removeClassName("modified");break}}var h=TableKit.getCellData(t);h.active=!1},m.prototype.edit=function(e){e=$(e);if(e.hasClassName("static"))return;var n=e.up("table"),r=e.up("tr"),i=r.id,s,o,u=$(document.createElement("form"));u.id=e.id+"-form",u.addClassName(TableKit.option("formClassName",n.id)[0]),u.onsubmit=this._submit.bindAsEventListener(this);var a=!1;if(this.name=="genre"){var f=document.createElement("select");f.id="genre",u.appendChild(f);for(o=0,s=t.length;o<s;++o){var l=t[o],c=document.createElement("option");c.value=l.id,c.appendChild(document.createTextNode(l.name)),f.appendChild(c)}for(o=0,s=this.uploadedFilesEdition.length;o<s;++o)"upload_line_"+escape(this.uploadedFilesEdition[o].filename)==i&&this.uploadedFilesEdition[o]["genre"]!=this.uploadedFiles[o]["genre"]&&(a=!0)}else{var h=document.createElement("input");h.type="text";for(o=0,s=this.uploadedFilesEdition.length;o<s;++o){var p=this.uploadedFilesEdition[o];if("upload_line_"+escape(p.filename)==i){this.name=="track"?p["track"].toString().indexOf("/")==-1?h.value=p.track:(h.value=p.track.toString().split("/")[0],p["track"].toString().split("/")[1]!=this.uploadedFiles[o]["track"].toString().split("/")[1]&&(a=!0)):this.name=="trackNb"?p["track"].toString().indexOf("/")==-1?h.value="0":(h.value=p.track.toString().split("/")[1],p["track"].toString().split("/")[1]!=this.uploadedFiles[o]["track"].toString().split("/")[1]&&(a=!0)):(h.value=p[this.name],p[this.name]!=this.uploadedFiles[o][this.name]&&(a=!0));break}}u.appendChild(h)}var d=document.createElement("input");d.type="submit",d.value="submit",d.className="editor_ok_button",u.appendChild(d);if(a){var v=document.createElement("a");v.href="#",v.appendChild(document.createTextNode("undo ")),v.onclick=this._undo.bindAsEventListener(this),v.className="editor_undo",u.appendChild(v),u.appendChild(document.createTextNode(" "))}var m=document.createElement("a");m.href="#",m.appendChild(document.createTextNode("cancel")),m.onclick=this._cancel.bindAsEventListener(this),m.className="editor_cancel",u.appendChild(m),e.innerHTML="",e.appendChild(u);for(o=0,s=this.uploadedFilesEdition.length;o<s;++o)if("upload_line_"+escape(this.uploadedFilesEdition[o].filename)==i){var g=$$("select#genre option"),y=g.length;y>0&&y<this.uploadedFilesEdition[o][this.name]&&(g[y-1].selected=!0);for(var b=0;b<y;b++)if(g[b].value==this.uploadedFilesEdition[o][this.name]){g[b].selected=!0;break}}};var g=0,b={status:function(){var e=this.name+" is "+(this.streaming?"":"NOT ")+"connected to url "+this.stream+" and currently "+(this.playing?"":"NOT ")+"playing. Current channel is: "+this.channel+". "+this.listenersCount+" user"+(this.listenersCount>1?"s are":" is")+" currently listening. Current song is: "+this.song.title+" - "+this.song.artist+".";return e},remaining:function(){var e=0;if(this.song&&this.lastServerResponse instanceof Date){var t=((new Date).getTime()-this.lastServerResponse.getTime())/1e3;return Math.round(this.song.duration-this.song.elapsed-t)}return e}};return r(y.prototype,b),y.defaults={URL:"/api/json",streamURL:"/stream",autorefresh:!0,autorefresh_delay:3e3,replaceTitle:!0},Object.freeze(y),Object.freeze(y.prototype),w.defaults={ActivityMonitorColor:{active:"orange",inactive:"green"},css:{}},w.skins=["default"],Object.freeze(w),Object.freeze(w.prototype),y}();